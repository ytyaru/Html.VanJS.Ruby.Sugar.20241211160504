# 簡易構文のエスケープ仕様改善案

　v25で気づいた。

## 現状

前|後
--|--
`|漢字《かんじ》`|`漢字《かんじ》`
`||漢字《かんじ》`|`｜漢字《かんじ》`
`￬￬漢字《かんじ》`|`↓漢字《かんじ》`
`«強調»`|`《《強調》》`

　次のような問題がある。

* `《`,`》`の字に対応するエスケープ方法がない
* 数が違う（二連続`|`,`￬`が大文字一個に変換されるという判り難さ）

## 改善案

前|後
--|--
`|`|`｜`
`￬`|`↓`
`«`|`《`
`»`|`》`

前|後
--|--
`漢字«かんじ»`|`漢字《かんじ》`
`|漢字«かんじ»`|`｜漢字《かんじ》`
`￬漢字«かんじ»`|`↓漢字《かんじ》`
`««強調»»`|《《強調》》

前|後
--|--
«剣術Lv.1»|《剣術Lv.1》

### 別案

　あるいは以下を追加すると完璧だろう。ただしレアケース故コストが無駄に嵩む。

前|後
--|--
`\|`|`|`
`\￬`|`￬`

　上記のように`\`をプレフィクスにするなら、全メタ文字に対してそうしたほうが統一感があって良いだろう。

前|後
--|--
`\《`|`《`
`\》`|`》`
`\｜`|`｜`
`\↓`|`↓`

　これにてメタ文字を減らせる。ただしエスケープするとき面倒になる。

```
\《\《強調\》\》
\｜漢字\《かんじ\》
\《剣術Lv.1\》
```

　以下の理由から却下したい。

* 入力の手間がかかる
* 視認性が悪い

　つまり`|`,`￬`の二文字に関しては「出力不可」である。場合によっては問題になるが、日本語小説の用途ではほぼ問題ないはず。よって当該メタ文字のエスケープは実装しないものとする。

# 理由

　HTML変換するほうを半角にしたほうが良いのでは？

　エスケープで全角をそのまま出力したいなら、その文字通りに出力してくれるほうが自然なのでは？

　つまり、以下のようにすべきでは？

前|後
--|--
`|漢字«かんじ»`|`<ruby>...</ruby>`
`｜漢字《かんじ》`|`｜漢字《かんじ》`

　この疑問に対しては次のような理由で否定する。

1. メタ文字`｜`,`↓`,`《》`のエスケープ使用頻度は低いはず
2. メタ文字エスケープよりもルビ要素HTMLの使用頻度のほうが高いはず
3. 日本語入力（全角）が基本なので使用頻度が高いほうに全角文字を割り当てたほうが高速に入力できるはず
4. 青空文庫やカクヨムと同じである

　よって、以下のようにメタ文字の全角・半角をそれぞれHTML変換・エスケープに割り当てる。

前|後
--|--
`｜漢字《かんじ》`|`<ruby>...</ruby>`
`|漢字«かんじ»`|`｜漢字《かんじ》`

## 1. エスケープの使用頻度は低いはず

　当コードは日本語小説の簡易構文である。日本語小説では漢字やひらがなが主体であり、当該メタ文字である`｜`,`↓`,`《`,`》`を使用する頻度は極めて稀である。

## 2. エスケープよりHTML変換のほうが使用頻度が高いはず

　当該メタ文字は稀ではあるが使いたい場合もあるだろう。それでも`<ruby>`や`<em>`のHTML変換のほうが使用頻度が高いはずだ。

　あるいはそれらHTML要素を手書きするより、当コードのメタ文字を使った簡易構文で自動生成したほうが楽に書けるはずだ。その効果の高さと比べたら、当該メタ文字をそのまま使うことよりも優先されるはずである。

```
｜漢字《かんじ》
```
```
<ruby>漢字<rp>（</rp><rt>かんじ</rt><rp>）</rp></ruby>
```

```
《《強調》》
```
```
<em>強調</em>
```

## 3. 日本語入力が基本なので使用頻度が高いほうに全角を割り当てるべき

　当コードは日本語小説の簡易構文である。テキスト入力するときは日本語入力が基本だ。つまり全角での入力が基本である。

　全角が基本なら、より使用頻度の高いものに全角を割り当てたほうが、高速に入力できるだろう。

　前述により、エスケープよりもHTML変換のほうが使用頻度が高いと考えた。よってHTML変換に全角メタ文字を割り当て、エスケープに半角メタ文字を割り当てた。

前|後
--|--
`｜漢字《かんじ》`|`<ruby>...</ruby>`
`|漢字«かんじ»`|`｜漢字《かんじ》`

## 4. 青空文庫やカクヨムと同じである

　全角メタ文字でHTML変換する記法は既存である。青空文庫やカクヨムでは当該方法にてHTML変換する。既存の方法と同じにすることで、互換性を持たせることが可能だ。

## エスケープされないメタ文字

　`|`,`«`,`»`のメタ文字はエスケープできない。それらは`｜`,`《`,`》`に変換されてしまう。

　もし`|`,`«`,`»`の文字を使いたくても不可能だ。これは当コードにおける簡易構文の制限である。

　ただし、当該文字を日本語小説で使うことはないと断言できる。

記号|意味
----|----
`|`|半角であり英語圏の記号である。
`«»`|英語圏の記号である。ギュメと呼び[引用符][]として用いられる`'`,`"`,`❞`,`❝`,`“`,`”`,`‘`,`’`,`「`,`」`,`『`,`』`

[引用符]:https://ja.wikipedia.org/wiki/%E5%BC%95%E7%94%A8%E7%AC%A6

　[引用符][]には次のような用途がある。

* 発言
* 固有名詞
* 強調

　`|`の文字はID、パスワード、プログラミングのソースコード等で表記したい場合が考えられる。ただし、いずれも日本語小説の本文では使用する場面がない字である。

## 他に使えそうな括弧文字

　[括弧][]はたくさん種類がある。

[括弧]:https://ja.wikipedia.org/wiki/%E6%8B%AC%E5%BC%A7

括弧（丸,鍵,角,波,山,亀甲,隅付）

丸括弧
()（）
⎛
⎜
⎝
⎞
⎟
⎠
︵
︶
﴾﴿
﹙﹚
❨❩
❪❫
⁽⁾
₍₎
⦅⦆
｟｠
⸨⸩


鍵括弧
｢｣
「」
﹁
﹂
『』
﹃
﹄

角括弧
[]
［］
⎡
⎢
⎣
⎤
⎥
⎦
﹇
﹈
〚〛
⟦⟧

波括弧
{}
｛｝
⎧
⎨
⎩
⎪
⎫
⎬
⎭
⎰
⎱
︷
︸
﹛﹜
❴❵


亀甲括弧
〔〕〘〙
❲❳⟬⟭
⟮⟯
︹
︺

山括弧
〈〉	《》
〈〉		⟪⟫
❬❭
❰❱
⧼⧽
⟨⟩
︿︽
﹀︾

ギュメ
‹›«»

不等号
<>

隅付括弧
【】〖〗
︻︗
︼︘

